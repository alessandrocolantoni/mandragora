/* ====================================================================
 *		      GNU GENERAL PUBLIC LICENSE
 *		         Version 2, June 1991
 *
 *    Copyright (C) 1989, 1991 Free Software Foundation, Inc.
 *                        51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 *    Everyone is permitted to copy and distribute verbatim copies
 *  of this license document, but changing it is not allowed.
 *
 *  			    Preamble
 *
 *    The licenses for most software are designed to take away your
 *  freedom to share and change it.  By contrast, the GNU General Public
 *  License is intended to guarantee your freedom to share and change free
 *  software--to make sure the software is free for all its users.  This
 *  General Public License applies to most of the Free Software
 *  Foundation's software and to any other program whose authors commit to
 *  using it.  (Some other Free Software Foundation software is covered by
 *  the GNU Library General Public License instead.)  You can apply it to
 *  your programs, too.
 *
 *    When we speak of free software, we are referring to freedom, not
 *  price.  Our General Public Licenses are designed to make sure that you
 *  have the freedom to distribute copies of free software (and charge for
 *  this service if you wish), that you receive source code or can get it
 *  if you want it, that you can change the software or use pieces of it
 *  in new free programs; and that you know you can do these things.
 *
 *     To protect your rights, we need to make restrictions that forbid
 *  anyone to deny you these rights or to ask you to surrender the rights.
 *  These restrictions translate to certain responsibilities for you if you
 *  distribute copies of the software, or if you modify it.
 *
 *     For example, if you distribute copies of such a program, whether
 *  gratis or for a fee, you must give the recipients all the rights that
 *  you have.  You must make sure that they, too, receive or can get the
 *  source code.  And you must show them these terms so they know their
 *  rights.
 *
 *     We protect your rights with two steps: (1) copyright the software, and
 *  (2) offer you this license which gives you legal permission to copy,
 *  distribute and/or modify the software.
 *
 *     Also, for each author's protection and ours, we want to make certain
 *  that everyone understands that there is no warranty for this free
 *  software.  If the software is modified by someone else and passed on, we
 *  want its recipients to know that what they have is not the original, so
 *  that any problems introduced by others will not reflect on the original
 *  authors' reputations.
 *
 *     Finally, any free program is threatened constantly by software
 *  patents.  We wish to avoid the danger that redistributors of a free
 *  program will individually obtain patent licenses, in effect making the
 *  program proprietary.  To prevent this, we have made it clear that any
 *  patent must be licensed for everyone's free use or not licensed at all.
 *
 *     The precise terms and conditions for copying, distribution and
 *  modification follow.
 *  
 *	                	    GNU GENERAL PUBLIC LICENSE
 *       TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
 *
 *     0. This License applies to any program or other work which contains
 *  a notice placed by the copyright holder saying it may be distributed
 *  under the terms of this General Public License.  The "Program", below,
 *  refers to any such program or work, and a "work based on the Program"
 *  means either the Program or any derivative work under copyright law:
 *  that is to say, a work containing the Program or a portion of it,
 *  either verbatim or with modifications and/or translated into another
 *  language.  (Hereinafter, translation is included without limitation in
 *  the term "modification".)  Each licensee is addressed as "you".
 *
 *     Activities other than copying, distribution and modification are not
 *  covered by this License; they are outside its scope.  The act of
 *  running the Program is not restricted, and the output from the Program
 *  is covered only if its contents constitute a work based on the
 *  Program (independent of having been made by running the Program).
 *  Whether that is true depends on what the Program does.
 *
 *     1. You may copy and distribute verbatim copies of the Program's
 *  source code as you receive it, in any medium, provided that you
 *  conspicuously and appropriately publish on each copy an appropriate
 *  copyright notice and disclaimer of warranty; keep intact all the
 *  notices that refer to this License and to the absence of any warranty;
 *  and give any other recipients of the Program a copy of this License
 *  along with the Program.
 *
 *  You may charge a fee for the physical act of transferring a copy, and
 *  you may at your option offer warranty protection in exchange for a fee.
 *
 *     2. You may modify your copy or copies of the Program or any portion
 *  of it, thus forming a work based on the Program, and copy and
 *  distribute such modifications or work under the terms of Section 1
 *  above, provided that you also meet all of these conditions:
 *
 *        a) You must cause the modified files to carry prominent notices
 *     stating that you changed the files and the date of any change.
 *
 *        b) You must cause any work that you distribute or publish, that in
 *     whole or in part contains or is derived from the Program or any
 *     part thereof, to be licensed as a whole at no charge to all third
 *     parties under the terms of this License.
 *
 *        c) If the modified program normally reads commands interactively
 *     when run, you must cause it, when started running for such
 *     interactive use in the most ordinary way, to print or display an
 *     announcement including an appropriate copyright notice and a
 *     notice that there is no warranty (or else, saying that you provide
 *     a warranty) and that users may redistribute the program under
 *     these conditions, and telling the user how to view a copy of this
 *     License.  (Exception: if the Program itself is interactive but
 *     does not normally print such an announcement, your work based on
 *     the Program is not required to print an announcement.)
 *     
 *     These requirements apply to the modified work as a whole.  If
 *  identifiable sections of that work are not derived from the Program,
 *  and can be reasonably considered independent and separate works in
 *  themselves, then this License, and its terms, do not apply to those
 *  sections when you distribute them as separate works.  But when you
 *  distribute the same sections as part of a whole which is a work based
 *  on the Program, the distribution of the whole must be on the terms of
 *  this License, whose permissions for other licensees extend to the
 *  entire whole, and thus to each and every part regardless of who wrote it.
 *
 *     Thus, it is not the intent of this section to claim rights or contest
 *  your rights to work written entirely by you; rather, the intent is to
 *  exercise the right to control the distribution of derivative or
 *  collective works based on the Program.
 *
 *     In addition, mere aggregation of another work not based on the Program
 *  with the Program (or with a work based on the Program) on a volume of
 *  a storage or distribution medium does not bring the other work under
 *  the scope of this License.
 *
 *      3. You may copy and distribute the Program (or a work based on it,
 *  under Section 2) in object code or executable form under the terms of
 *  Sections 1 and 2 above provided that you also do one of the following:
 *
 *        a) Accompany it with the complete corresponding machine-readable
 *     source code, which must be distributed under the terms of Sections
 *     1 and 2 above on a medium customarily used for software interchange; or,
 *
 *        b) Accompany it with a written offer, valid for at least three
 *     years, to give any third party, for a charge no more than your
 *     cost of physically performing source distribution, a complete
 *     machine-readable copy of the corresponding source code, to be
 *     distributed under the terms of Sections 1 and 2 above on a medium
 *     customarily used for software interchange; or,
 *
 *        c) Accompany it with the information you received as to the offer
 *     to distribute corresponding source code.  (This alternative is
 *     allowed only for noncommercial distribution and only if you
 *     received the program in object code or executable form with such
 *     an offer, in accord with Subsection b above.)
 *
 *  The source code for a work means the preferred form of the work for
 *  making modifications to it.  For an executable work, complete source
 *  code means all the source code for all modules it contains, plus any
 *  associated interface definition files, plus the scripts used to
 *  control compilation and installation of the executable.  However, as a
 *  special exception, the source code distributed need not include
 *  anything that is normally distributed (in either source or binary
 *  form) with the major components (compiler, kernel, and so on) of the
 *  operating system on which the executable runs, unless that component
 *  itself accompanies the executable.
 *
 *  If distribution of executable or object code is made by offering
 *  access to copy from a designated place, then offering equivalent
 *  access to copy the source code from the same place counts as
 *  distribution of the source code, even though third parties are not
 *  compelled to copy the source along with the object code.
 *  
 *     4. You may not copy, modify, sublicense, or distribute the Program
 *  except as expressly provided under this License.  Any attempt
 *  otherwise to copy, modify, sublicense or distribute the Program is
 *  void, and will automatically terminate your rights under this License.
 *  However, parties who have received copies, or rights, from you under
 *  this License will not have their licenses terminated so long as such
 *  parties remain in full compliance.
 *
 *    5. You are not required to accept this License, since you have not
 *  signed it.  However, nothing else grants you permission to modify or
 *  distribute the Program or its derivative works.  These actions are
 *  prohibited by law if you do not accept this License.  Therefore, by
 *  modifying or distributing the Program (or any work based on the
 *  Program), you indicate your acceptance of this License to do so, and
 *  all its terms and conditions for copying, distributing or modifying
 *  the Program or works based on it.
 *
 *    6. Each time you redistribute the Program (or any work based on the
 *  Program), the recipient automatically receives a license from the
 *  original licensor to copy, distribute or modify the Program subject to
 *  these terms and conditions.  You may not impose any further
 *  restrictions on the recipients' exercise of the rights granted herein.
 *  You are not responsible for enforcing compliance by third parties to
 *  this License.
 *
 *    7. If, as a consequence of a court judgment or allegation of patent
 *  infringement or for any other reason (not limited to patent issues),
 *  conditions are imposed on you (whether by court order, agreement or
 *  otherwise) that contradict the conditions of this License, they do not
 *  excuse you from the conditions of this License.  If you cannot
 *  distribute so as to satisfy simultaneously your obligations under this
 *  License and any other pertinent obligations, then as a consequence you
 *  may not distribute the Program at all.  For example, if a patent
 *  license would not permit royalty-free redistribution of the Program by
 *  all those who receive copies directly or indirectly through you, then
 *  the only way you could satisfy both it and this License would be to
 *  refrain entirely from distribution of the Program.

 *  If any portion of this section is held invalid or unenforceable under
 *  any particular circumstance, the balance of the section is intended to
 *  apply and the section as a whole is intended to apply in other
 *  circumstances.

 *  It is not the purpose of this section to induce you to infringe any
 *  patents or other property right claims or to contest validity of any
 *  such claims; this section has the sole purpose of protecting the
 *  integrity of the free software distribution system, which is
 *  implemented by public license practices.  Many people have made
 *  generous contributions to the wide range of software distributed
 *  through that system in reliance on consistent application of that
 *  system; it is up to the author/donor to decide if he or she is willing
 *  to distribute software through any other system and a licensee cannot
 *  impose that choice.

 *  This section is intended to make thoroughly clear what is believed to
 *  be a consequence of the rest of this License.
 *  
 *    8. If the distribution and/or use of the Program is restricted in
 *  certain countries either by patents or by copyrighted interfaces, the
 *  original copyright holder who places the Program under this License
 *  may add an explicit geographical distribution limitation excluding
 *  those countries, so that distribution is permitted only in or among
 *  countries not thus excluded.  In such case, this License incorporates
 *  the limitation as if written in the body of this License.
 *
 *    9. The Free Software Foundation may publish revised and/or new versions
 *  of the General Public License from time to time.  Such new versions will
 *  be similar in spirit to the present version, but may differ in detail to
 *  address new problems or concerns.
 *
 *  Each version is given a distinguishing version number.  If the Program
 *  specifies a version number of this License which applies to it and "any
 *  later version", you have the option of following the terms and conditions
 *  either of that version or of any later version published by the Free
 *  Software Foundation.  If the Program does not specify a version number of
 *  this License, you may choose any version ever published by the Free Software
 *  Foundation.

 *    10. If you wish to incorporate parts of the Program into other free
 *  programs whose distribution conditions are different, write to the author
 *  to ask for permission.  For software which is copyrighted by the Free
 *  Software Foundation, write to the Free Software Foundation; we sometimes
 *  make exceptions for this.  Our decision will be guided by the two goals
 *  vof preserving the free status of all derivatives of our free software and
 *  of promoting the sharing and reuse of software generally.
 *
 *  			    NO WARRANTY
 *
 *    11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
 *  FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
 *  OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
 *  PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
 *  OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
 *  TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
 *  PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
 *  REPAIR OR CORRECTION.
 *
 *    12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
 *  WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
 *  REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
 *  INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
 *  OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
 *  TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
 *  YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
 *  PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
 *  POSSIBILITY OF SUCH DAMAGES.
 *
 *  		     END OF TERMS AND CONDITIONS
 *  
 *  	    How to Apply These Terms to Your New Programs
 *    If you develop a new program, and you want it to be of the greatest
 *  possible use to the public, the best way to achieve this is to make it
 *  free software which everyone can redistribute and change under these terms.
 *
 *    To do so, attach the following notices to the program.  It is safest
 *  to attach them to the start of each source file to most effectively
 *  convey the exclusion of warranty; and each file should have at least
 *  the "copyright" line and a pointer to where the full notice is found.
 *
 *      <one line to give the program's name and a brief idea of what it does.>
 *      Copyright (C) <year>  <name of author>
 *
 *      This program is free software; you can redistribute it and/or modify
 *      it under the terms of the GNU General Public License as published by
 *      the Free Software Foundation; either version 2 of the License, or
 *      (at your option) any later version.
 *
 *      This program is distributed in the hope that it will be useful,
 *      but WITHOUT ANY WARRANTY; without even the implied warranty of
 *      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *      GNU General Public License for more details.
 *
 *      You should have received a copy of the GNU General Public License
 *      along with this program; if not, write to the Free Software
 *      Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 *
 *
 *  Also add information on how to contact you by electronic and paper mail.
 *
 *  If the program is interactive, make it output a short notice like this
 *  when it starts in an interactive mode:
 *
 *      Gnomovision version 69, Copyright (C) year name of author
 *      Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
 *      This is free software, and you are welcome to redistribute it
 *      under certain conditions; type `show c' for details.
 *
 *  The hypothetical commands `show w' and `show c' should show the appropriate
 *  parts of the General Public License.  Of course, the commands you use may
 *  be called something other than `show w' and `show c'; they could even be
 *  mouse-clicks or menu items--whatever suits your program.
 *
 *  You should also get your employer (if you work as a programmer) or your
 *  school, if any, to sign a "copyright disclaimer" for the program, if
 *  necessary.  Here is a sample; alter the names:
 *
 *    Yoyodyne, Inc., hereby disclaims all copyright interest in the program
 *    `Gnomovision' (which makes passes at compilers) written by James Hacker.
 *
 *    <signature of Ty Coon>, 1 April 1989
 *    Ty Coon, President of Vice

 *  This General Public License does not permit incorporating your program into
 *  proprietary programs.  If your program is a subroutine library, you may
 *  consider it more useful to permit linking proprietary applications with the
 *  library.  If this is what you want to do, use the GNU Library General
 *  Public License instead of this License.

*/

package it.aco.mandragora.serviceFacade.context.pojoFacade;

import it.aco.mandragora.bo.ValueObjectsAttributeMapBO;
import it.aco.mandragora.exception.*;
import it.aco.mandragora.as.ApplicationService;
import it.aco.mandragora.as.context.ContextApplicationService;
import it.aco.mandragora.common.ServiceLocator;
import it.aco.mandragora.common.Utils;
import it.aco.mandragora.common.utils.BeanCollectionUtils;
import it.aco.mandragora.dao.context.ContextDAO;
import it.aco.mandragora.serviceFacade.context.ContextServiceFacade;

import java.util.*;
import java.lang.reflect.InvocationTargetException;

import org.apache.commons.beanutils.PropertyUtilsBean;
import org.apache.commons.beanutils.BeanUtilsBean;
import org.apache.commons.beanutils.ConstructorUtils;
import org.apache.commons.chain.Context;

public class ContextPojoFacade implements ContextServiceFacade {

    protected static ContextPojoFacade contextPojoFacade = null;
    protected static String ContextApplicationServiceFactoryClassName = null;
    protected static String ContextApplicationServiceClassName = null;

    protected static String ApplicationServiceFactoryClassName = null;
    protected static String ApplicationServiceClassName = null;

    protected static String ContextDAOFactoryClassName = null;
    protected static String ContextDAOClassName = null;

    private static org.apache.log4j.Category log = org.apache.log4j.Logger.getLogger(ContextPojoFacade.class.getName());

    static {
        try {
            if (contextPojoFacade!=null) throw new ServiceFacadeException("thrown in the static block of ContextPojoFacade: static instance is already set");
            contextPojoFacade = new ContextPojoFacade();
        }catch (Exception e){
            throw new RuntimeException("Exception thrown in the static block of ContextPojoFacade "+ e.toString(),e);
        }
        ContextApplicationServiceFactoryClassName = "ContextPojoFacade.ContextApplicationServiceFactoryClass" ;
        ContextApplicationServiceClassName = "ContextPojoFacade.ContextApplicationServiceClass" ;

        ApplicationServiceFactoryClassName = "ContextPojoFacade.ApplicationServiceFactoryClass" ;
        ApplicationServiceClassName = "ContextPojoFacade.ApplicationServiceClass" ;

        ContextDAOFactoryClassName = "ContextPojoFacade.ContextDAOFactoryClass" ;
        ContextDAOClassName =   "ContextPojoFacade.ContextDAOClass" ;
    }

    protected ContextPojoFacade() {
    }

    public static ContextPojoFacade getInstance() {
        return contextPojoFacade;
    }
    protected String getContextApplicationServiceFactoryClassName(Context context) throws ServiceFacadeException{
        try{
            if(context==null) return ContextApplicationServiceFactoryClassName;
            String contextApplicationServiceFactoryClassName = (String) context.get("contextApplicationServiceFactoryClassName");
            if (contextApplicationServiceFactoryClassName==null)contextApplicationServiceFactoryClassName= ContextApplicationServiceFactoryClassName;
            return contextApplicationServiceFactoryClassName;
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.getContextApplicationServiceFactoryClassName(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getContextApplicationServiceFactoryClassName(Context context)" + e.toString(),e);
        }
    }

    protected String getContextApplicationServiceClassName(Context context) throws ServiceFacadeException{
        try{
            if(context==null) return ContextApplicationServiceClassName;
            String contextApplicationServiceClassName = (String) context.get("contextApplicationServiceClassName");
            if (contextApplicationServiceClassName==null)contextApplicationServiceClassName= ContextApplicationServiceClassName;
            return contextApplicationServiceClassName;
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.getContextApplicationServiceClassName(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getContextApplicationServiceClassName(Context context)" + e.toString(),e);
        }
    }

    protected ContextApplicationService getContextApplicationService(Context context)throws ServiceFacadeException{
        try{
            return ServiceLocator.getInstance().getContextApplicationService(getContextApplicationServiceFactoryClassName(context), getContextApplicationServiceClassName(context));
        }catch (ServiceLocatorException e) {
            log.error("ServiceLocatorException caught in ContextPojoFacade.getContextApplicationService(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getContextApplicationService(Context context)" + e.toString(),e);
        }
    }

    protected String getApplicationServiceFactoryClassName(Context context) throws ServiceFacadeException{
        try{
            if(context==null) return ApplicationServiceFactoryClassName;
            String applicationServiceFactoryClassName = (String) context.get("applicationServiceFactoryClassName");
            if (applicationServiceFactoryClassName==null)applicationServiceFactoryClassName=ApplicationServiceFactoryClassName;
            return applicationServiceFactoryClassName;
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.getContextApplicationServiceFactoryClassName(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getContextApplicationServiceFactoryClassName(Context context)" + e.toString(),e);
        }
    }

    protected String getApplicationServiceClassName(Context context) throws ServiceFacadeException{
        try{
            if(context==null) return ApplicationServiceClassName;
            String applicationServiceClassName = (String) context.get("applicationServiceClassName");
            if (applicationServiceClassName==null)applicationServiceClassName=ApplicationServiceClassName;
            return applicationServiceClassName;
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.getContextApplicationServiceClassName(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getContextApplicationServiceClassName(Context context)" + e.toString(),e);
        }
    }

    protected ApplicationService getApplicationService(Context context)throws ServiceFacadeException{
        try{
            return ServiceLocator.getInstance().getApplicationService(getApplicationServiceFactoryClassName(context),getApplicationServiceClassName(context));
        }catch (ServiceLocatorException e) {
            log.error("ServiceLocatorException caught in ContextPojoFacade.getContextApplicationService(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getContextApplicationService(Context context)" + e.toString(),e);
        }
    }

    protected String getContextDAOFactoryClassName(Context context) throws ServiceFacadeException{
        try{
            //if(context==null)throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getContextDAOFactoryClassName(Context context) : context can't be null");
            if(context==null) return ContextDAOFactoryClassName;
            String contextDaoFactoryClassName = (String) context.get("contextDaoFactoryClassName");
            if (contextDaoFactoryClassName==null)contextDaoFactoryClassName= ContextDAOFactoryClassName;
            return contextDaoFactoryClassName;
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.getContextDAOFactoryClassName(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getContextDAOFactoryClassName(Context context)" + e.toString(),e);
        }
    }

    protected String getContextDAOClassName(Context context) throws ServiceFacadeException{
        try{
            //if(context==null)throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getContextDAOClassName(Context context) : context can't be null");
            if(context==null) return ContextDAOClassName;
            String contextDaoClassName = (String) context.get("contextDaoClassName");
            if (contextDaoClassName==null)contextDaoClassName= ContextDAOClassName;
            return contextDaoClassName;
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.getContextDAOClassName(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getContextDAOClassName(Context context)" + e.toString(),e);
        }
    }

    protected ContextDAO getContextDAO(Context context)throws ServiceFacadeException{
        try{
            return ServiceLocator.getInstance().getContextDAO(getContextDAOFactoryClassName(context), getContextDAOClassName(context));
        }catch (ServiceLocatorException e) {
            log.error("ServiceLocatorException caught in ContextPojoFacade.getContextDAO(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getContextDAO(Context context)" + e.toString(),e);
        }
    }


    /**
     *
     * @param context
     * @return
     * @throws ServiceFacadeException
     */
    public Object findByPrimaryKey(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.findByPrimaryKey(context);
        }  catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.findByPrimaryKey(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findByPrimaryKey(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.findByPrimaryKey(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findByPrimaryKey(Context context)" + e.toString(),e);
        }
    }


    public Collection findCollectionByTemplate(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.findCollectionByTemplate( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.findCollectionByTemplate(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByTemplate(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.findCollectionByTemplate(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByTemplate(Context context)" + e.toString(),e);
        }
    }


    public Object findObjectByTemplate(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.findObjectByTemplate( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.findObjectByTemplate(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findObjectByTemplate(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.findObjectByTemplate(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findObjectByTemplate(Context context)" + e.toString(),e);
        }
    }


    public Collection findCollectionByNullFields(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.findCollectionByNullFields( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.findCollectionByNullFields(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByNullFields(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.findCollectionByNullFields(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByNullFields(Context context)" + e.toString(),e);
        }
    }


    public Collection findCollectionByLogicCondition(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.findCollectionByLogicCondition( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.findCollectionByLogicCondition(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByLogicCondition(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.findCollectionByLogicCondition(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByLogicCondition(Context context)" + e.toString(),e);
        }
    }




    public Collection findCollectionByOrValues(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.findCollectionByOrValues( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.findCollectionByOrValues(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByOrValues(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.findCollectionByOrValues(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByOrValues(Context context)" + e.toString(),e);
        }
    }



    public Collection findCollectionByAndFieldsOperatorValues(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.findCollectionByAndFieldsOperatorValues( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.findCollectionByAndFieldsOperatorValues(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByAndFieldsOperatorValues(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.findCollectionByAndFieldsOperatorValues(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByAndFieldsOperatorValues(Context context)" + e.toString(),e);
        }
    }


    public Collection findCollectionByArrayOfFieldsOperatorsMatrixAndOrValues(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.findCollectionByArrayOfFieldsOperatorsMatrixAndOrValues( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.findCollectionByArrayOfFieldsOperatorsMatrixAndOrValues(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByArrayOfFieldsOperatorsMatrixAndOrValues(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.findCollectionByArrayOfFieldsOperatorsMatrixAndOrValues(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByArrayOfFieldsOperatorsMatrixAndOrValues(Context context)" + e.toString(),e);
        }
    }



    public Collection findCollectionByFieldsNotEqualsToValues(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.findCollectionByFieldsNotEqualsToValues( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.findCollectionByFieldsNotEqualsToValues(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByFieldsNotEqualsToValues(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.findCollectionByFieldsNotEqualsToValues(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByFieldsNotEqualsToValues(Context context)" + e.toString(),e);
        }
    }


    public Collection searchValueInFields(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.searchValueInFields( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.searchValueInFields(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.searchValueInFields(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.searchValueInFields(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.searchValueInFields(Context context)" + e.toString(),e);
        }
    }


    public Collection findCollectionByFieldInCollection(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.findCollectionByFieldInCollection( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.findCollectionByFieldInCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByFieldInCollection(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.findCollectionByFieldInCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.findCollectionByFieldInCollection(Context context)" + e.toString(),e);
        }
    }


    public Collection getCollectionOfStoredItemsNotInBean(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.getCollectionOfStoredItemsNotInBean( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.getCollectionOfStoredItemsNotInBean(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getCollectionOfStoredItemsNotInBean(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.getCollectionOfStoredItemsNotInBean(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getCollectionOfStoredItemsNotInBean(Context context)" + e.toString(),e);
        }
    }



    public Collection getStoredCollection(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.getStoredCollection( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.getStoredCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getStoredCollection(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.getStoredCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getStoredCollection(Context context)" + e.toString(),e);
        }
    }


    public Iterator getReportQueryIterator(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.getReportQueryIterator( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.getReportQueryIterator(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getReportQueryIterator(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.getReportQueryIterator(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getReportQueryIterator(Context context)" + e.toString(),e);
        }
    }


    public void retrieveReference(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.retrieveReference( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrieveReference(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveReference(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrieveReference(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveReference(Context context)" + e.toString(),e);
        }
    }


    public void retrieveAllReferences(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.retrieveAllReferences( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrieveAllReferences(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveAllReferences(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrieveAllReferences(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveAllReferences(Context context)" + e.toString(),e);
        }
    }


    public void retrieveAllReferencesInCollection(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.retrieveAllReferencesInCollection( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrieveAllReferencesInCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveAllReferencesInCollection(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrieveAllReferencesInCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveAllReferencesInCollection(Context context)" + e.toString(),e);
        }
    }


    public void retrieveReferenceInCollection(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.retrieveReferenceInCollection( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrieveReferenceInCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveReferenceInCollection(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrieveReferenceInCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveReferenceInCollection(Context context)" + e.toString(),e);
        }
    }


    public void retrievePathReference(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.retrievePathReference( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrievePathReference(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrievePathReference(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrievePathReference(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrievePathReference(Context context)" + e.toString(),e);
        }
    }


    public void retrieveNullPathReference(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.retrieveNullPathReference( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrieveNullPathReference(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveNullPathReference(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrieveNullPathReference(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveNullPathReference(Context context)" + e.toString(),e);
        }
    }


    public void retrieveNullReference(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.retrieveNullReference( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrieveNullReference(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveNullReference(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrieveNullReference(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveNullReference(Context context)" + e.toString(),e);
        }
    }

    public void retrieveAllNullReferences(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.retrieveAllNullReferences( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrieveAllNullReferences(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveAllNullReferences(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.retrieveAllNullReferences(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveAllNullReferences(Context context)" + e.toString(),e);
        }
    }

    public void delete(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.delete( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.delete(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.delete(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.delete(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.delete(Context context)" + e.toString(),e);
        }
    }

    public void deleteCollection(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.deleteCollection( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.deleteCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.deleteCollection(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.deleteCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.deleteCollection(Context context)" + e.toString(),e);
        }
    }


    public void deleteMToNRelationshipCollection(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.deleteMToNRelationshipCollection( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.deleteMToNRelationshipCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.deleteMToNRelationshipCollection(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.deleteMToNRelationshipCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.deleteMToNRelationshipCollection(Context context)" + e.toString(),e);
        }
    }

    public void deleteItemsNotInCollectionsInPath(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.deleteItemsNotInCollectionsInPath( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.deleteItemsNotInCollectionsInPath(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.deleteItemsNotInCollectionsInPath(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.deleteItemsNotInCollectionsInPath(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.deleteItemsNotInCollectionsInPath(Context context)" + e.toString(),e);
        }
    }

    public void deleteItemsNotInCollectionsInPaths(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.deleteItemsNotInCollectionsInPaths( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.deleteItemsNotInCollectionsInPaths(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.deleteItemsNotInCollectionsInPaths(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.deleteItemsNotInCollectionsInPaths(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.deleteItemsNotInCollectionsInPaths(Context context)" + e.toString(),e);
        }
    }

    public void deletePathCascade(Context context)  throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.deletePathCascade( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.deletePathCascade(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.deletePathCascade(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.deletePathCascade(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.deletePathCascade(Context context)" + e.toString(),e);
        }
    }

    public void deletePathsCascade(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.deletePathsCascade( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.deletePathsCascade(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.deletePathsCascade(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.deletePathsCascade(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.deletePathsCascade(Context context)" + e.toString(),e);
        }
    }



    public Object insert(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.insert( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.insert(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.insert(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.insert(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.insert(Context context)" + e.toString(),e);
        }
    }


    public Object update(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.update( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.update(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.update(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.update(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.update(Context context)" + e.toString(),e);
        }
    }


    public void updateCollection(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.updateCollection( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.updateCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.updateCollection(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.updateCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.updateCollection(Context context)" + e.toString(),e);
        }
    }



   public Object updateCollectionReference(Context context)throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.updateCollectionReference( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.updateCollectionReference(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.updateCollectionReference(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.updateCollectionReference(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.updateCollectionReference(Context context)" + e.toString(),e);
        }
    }




    public Object updateCollectionReferences(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.updateCollectionReferences( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.updateCollectionReferences(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.updateCollectionReferences(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.updateCollectionReferences(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.updateCollectionReferences(Context context)" + e.toString(),e);
        }
    }

    public void storePathCascade(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.storePathCascade( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.storePathCascade(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.storePathCascade(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.storePathCascade(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.storePathCascade(Context context)" + e.toString(),e);
        }
    }

    public void storePathsCascade(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.storePathsCascade( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.storePathsCascade(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.storePathsCascade(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.storePathsCascade(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.storePathsCascade(Context context)" + e.toString(),e);
        }
    }













    public Object updateCreateTrees(Context context) throws ServiceFacadeException{
        try {
            ContextDAO contextDAO = getContextDAO(context);
            return contextDAO.updateCreateTrees( context);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.updateCreateTrees(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.updateCreateTrees(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.updateCreateTrees(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.updateCreateTrees(Context context)" + e.toString(),e);
        }
    }

    /***********************************************************************************************************************************/




    public Map buildMap(Context context) throws ServiceFacadeException{

        try{
            ContextApplicationService contextApplicationService = getContextApplicationService(context);
            Object pInstance = context.get("pInstance");
            String pAttributeName = (String) context.get("pAttributeName");
            Collection valueObjectsCollection = (Collection) context.get("valueObjectsCollection");
            if(pInstance!=null || pAttributeName!=null) valueObjectsCollection = contextApplicationService.getReferenceCollectionOrRetrieveIfNull(context);

            String valueObjectKeyAttributeName = (String) context.get("valueObjectKeyAttributeName");
            Boolean isValueObjectKeyAttributeNameToSet =(Boolean) context.get("isValueObjectKeyAttributeNameToSet");

            //if(isValueObjectKeyAttributeNameToSet!=null && isValueObjectKeyAttributeNameToSet.booleanValue())Utils.setField(valueObjectsCollection,valueObjectKeyAttributeName);
            if(isValueObjectKeyAttributeNameToSet!=null && isValueObjectKeyAttributeNameToSet)Utils.setField(valueObjectsCollection,valueObjectKeyAttributeName);

            String valueObjectValueAttributeName =(String) context.get("valueObjectValueAttributeName");
            String mapValueClassAttributeToSetName = (String) context.get("mapValueClassAttributeToSetName");
            Class mapValueClass = (Class) context.get("mapValueClass");
            return new ValueObjectsAttributeMapBO(valueObjectsCollection, valueObjectKeyAttributeName, valueObjectValueAttributeName, mapValueClassAttributeToSetName, mapValueClass);

        }catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.buildMap(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.buildMap(Context context)" + e.toString(),e);
        }catch (BusinessObjectException e) {
            log.error("BusinessObjectException caught in ContextPojoFacade.buildMap(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.buildMap(Context context)" + e.toString(),e);
        }catch (IllegalAccessException e) {
            log.error("IllegalAccessException caught in ContextPojoFacade.buildMap(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.buildMap(Context context)" + e.toString(),e);
        }catch (InvocationTargetException e) {
            log.error("InvocationTargetException caught in ContextPojoFacade.buildMap(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.buildMap(Context context)" + e.toString(),e);
        }catch (NoSuchMethodException e) {
            log.error("NoSuchMethodException caught in ContextPojoFacade.buildMap(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.buildMap(Context context)" + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.buildMap(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.buildMap(Context context)" + e.toString(),e);
        }

    }

    public Map addToMap(Context context) throws ServiceFacadeException{
        try{
            ApplicationService applicationService  = getApplicationService(context);
            ContextApplicationService contextApplicationService  = getContextApplicationService(context);

            Object pInstance = context.get("pInstance");
            String pAttributeName = (String) context.get("pAttributeName");
            Collection valueObjectsCollection = (Collection) context.get("valueObjectsCollection");
            if(pInstance!=null || pAttributeName!=null) valueObjectsCollection = contextApplicationService.getReferenceCollectionOrRetrieveIfNull(context);


            Map map = (Map) context.get("map");
            String valueObjectKeyAttributeName = (String) context.get("valueObjectKeyAttributeName");
            Boolean isValueObjectKeyAttributeNameToSet = (Boolean) context.get("isValueObjectKeyAttributeNameToSet");
            String valueObjectValueAttributeName = (String) context.get("valueObjectValueAttributeName");
            String mapValueClassAttributeToSetName = (String) context.get("mapValueClassAttributeToSetName");
            Class mapValueClass = (Class) context.get("mapValueClass");

            //if(isValueObjectKeyAttributeNameToSet.booleanValue())Utils.setField(valueObjectsCollection,valueObjectKeyAttributeName);
            if(isValueObjectKeyAttributeNameToSet!=null && isValueObjectKeyAttributeNameToSet)Utils.setField(valueObjectsCollection,valueObjectKeyAttributeName);

            //applicationService.addNoOverwrite(valueObjectsCollection, map, valueObjectKeyAttributeName, valueObjectValueAttributeName);
            applicationService.addNoOverwrite(valueObjectsCollection, map, valueObjectKeyAttributeName, valueObjectValueAttributeName, mapValueClassAttributeToSetName,mapValueClass);
            return map;
        }catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.addToMap(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToMap(Context context)" + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.addToMap(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToMap(Context context)" + e.toString(),e);
        }

    }

    /**
     * 
     * @param context
     * @throws ServiceFacadeException
     */
    public void updateCollectionWithMap(Context context)throws ServiceFacadeException{
        try{
            ApplicationService applicationService = getApplicationService(context);
            ContextApplicationService contextApplicationService  = getContextApplicationService(context);// added by alessandro on 27-nov-2008

            Object pInstance = context.get("pInstance");
            String pAttributeName = (String) context.get("pAttributeName");
            Collection valueObjectsCollection = (Collection) context.get("valueObjectsCollection");

            if(pInstance!=null || pAttributeName!=null) valueObjectsCollection = contextApplicationService.getReferenceCollectionOrRetrieveIfNull(context);// added by alessandro on 27-nov-2008

            /*  deleted by alessandro on 27-nov-2008
            PropertyUtilsBean propertyUtilsBean = BeanUtilsBean.getInstance().getPropertyUtils();
            if(pInstance!=null||pAttributeName!=null) valueObjectsCollection = (Collection)propertyUtilsBean.getProperty(pInstance,pAttributeName);
            */

            Map map = (Map) context.get("map");
            String valueObjectKeyAttributeName = (String) context.get("valueObjectKeyAttributeName");


            String valueObjectValueAttributeName = (String) context.get("valueObjectValueAttributeName");
            applicationService.updateCollectionWithMap(valueObjectsCollection,  map,  valueObjectKeyAttributeName,  valueObjectValueAttributeName);

        }catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.updateCollectionWithMap(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.updateCollectionWithMap(Context context)" + e.toString(),e);
        }/* deleted by alessandro on 27-nov-2008
        catch (IllegalAccessException e) {
            log.error("IllegalAccessException caught in ContextPojoFacade.updateCollectionWithMap(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.updateCollectionWithMap(Context context)" + e.toString(),e);
        }catch (NoSuchMethodException e) {
            log.error("NoSuchMethodException caught in ContextPojoFacade.updateCollectionWithMap(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.updateCollectionWithMap(Context context)" + e.toString(),e);
        }catch (InvocationTargetException e) {
            log.error("InvocationTargetException caught in ContextPojoFacade.updateCollectionWithMap(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.updateCollectionWithMap(Context context)" + e.toString(),e);
        }*/catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.updateCollectionWithMap(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.updateCollectionWithMap(Context context)" + e.toString(),e);
        }
    }

    /**
     * @deprecated use {@link BeanCollectionUtils#getTreeLeaves(Object valueobjectOrCollection, String path)}
     * @param context
     * @return
     * @throws ServiceFacadeException
     */
    public Collection getTreeLeaves(Context context) throws ServiceFacadeException {
        try{
            ApplicationService applicationService = getApplicationService(context);
            return applicationService.getTreeLeaves(context.get("valueobjectOrCollection"),(String) context.get("path"));
        }catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.getTreeLeaves(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getTreeLeaves(Context context)" + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.getTreeLeaves(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.getTreeLeaves(Context context)" + e.toString(),e);
        }
    }


    public Collection retrieveTreeLeaves(Context context) throws ServiceFacadeException {
        try{
            //ApplicationService applicationService = getApplicationService(context); deleted By Alessandro on 27-nov-2008

            log.debug("ContextPojoFacade.retrieveTreeLeaves : path  before contextDAO call = "+context.get("path"));
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.retrievePathReference(context);
            //return applicationService.getTreeLeaves(context.get("valueobjectOrCollection"),(String)  context.get("path")); deleted by Alessandro on 27-nov-2008
            log.debug("ContextPojoFacade.retrieveTreeLeaves : path  after contextDAO call = "+context.get("path"));
            return BeanCollectionUtils.getTreeLeaves(context.get("valueobjectOrCollection"),(String)  context.get("path")); //added by Alessandro on 27-nov-2008
        }catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.retrieveTreeLeaves(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveTreeLeaves(Context context)" + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.retrieveTreeLeaves(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveTreeLeaves(Context context)" + e.toString(),e);
        }
    }


    public Collection retrieveNullPathTreeLeaves(Context context) throws ServiceFacadeException {
        try{
            ApplicationService applicationService = getApplicationService(context);
            ContextDAO contextDAO = getContextDAO(context);
            contextDAO.retrieveNullPathReference(context);
            return applicationService.getTreeLeaves(context.get("valueobjectOrCollection"), (String) context.get("path"));
        }catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.retrieveNullPathTreeLeaves(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveNullPathTreeLeaves(Context context)" + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.retrieveNullPathTreeLeaves(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retrieveNullPathTreeLeaves(Context context)" + e.toString(),e);
        }
    }


    public void addToRetainInCollectionTreeLeaves(Context context) throws ServiceFacadeException{
        try{
            ApplicationService applicationService = getApplicationService(context);
            ContextApplicationService contextApplicationService = getContextApplicationService(context);
            ContextDAO contextDAO = getContextDAO(context);

            Object pInstance = context.get("pInstance");
            String pAttributeName =(String) context.get("pAttributeName");
            String[] attributesComparator = (String[]) context.get("attributesComparator");
            String path = (String) context.get("path");
            String[] sourcePAttributeNames = (String[]) context.get("sourcePAttributeNames");
            String[] targetPAttributeNames = (String[]) context.get("targetPAttributeNames");
            Object[] valuesArray = (Object[]) context.get("valuesArray");
            String[] pAttributeNames = (String[]) context.get("pAttributeNames");

            Object collectionImplClass = context.get("collectionImplClass");//added by Alessandro on 8-dec-2008
            context.put("collectionImplClass",null);     //added by Alessandro on 8-dec-2008
            Collection valueObjectsCollection = contextApplicationService.getReferenceCollectionOrEmptyIfNull(context);
            context.put("collectionImplClass",collectionImplClass);     //added by Alessandro on 8-dec-2008

            if (valueObjectsCollection == null) return;

            Object realClass = context.get("realClass");

            context.put("realClass",pInstance.getClass());
            context.put("path",pAttributeName);
            Class pAttributeNameElementClass  =  contextDAO.getClassFromPath(context);
            context.put("path",path);

            if(attributesComparator==null){
                context.put("realClass",pAttributeNameElementClass);
                attributesComparator = contextDAO.getPkNames(context);
            }

            //Collection treeLeaves = applicationService.getTreeLeaves(pInstance,path);  // deleted by Alessandro on 30-Nov-2008
            // start added by Alessandro on 30-Nov-2008
            Collection treeLeaves = BeanCollectionUtils.getTreeLeaves(pInstance,path);

            if(sourcePAttributeNames==null) sourcePAttributeNames=targetPAttributeNames;
            if(targetPAttributeNames==null) targetPAttributeNames=sourcePAttributeNames;
            // end added by Alessandro on 30-Nov-2008
            String[] newSourcePAttributeNames =(String[]) Utils.arrayUnion(sourcePAttributeNames,attributesComparator);
            String[] newTargetPAttributeNames =(String[]) Utils.arrayUnion(targetPAttributeNames,attributesComparator);


            context.put("realClass",pInstance.getClass());
            Class treeLeavesClass = contextDAO.getClassFromPath(context);
            context.put("realClass",realClass);

            if (treeLeavesClass.equals(pAttributeNameElementClass))pAttributeNameElementClass=null;

            Collection transformedTreeLeaves = BeanCollectionUtils.createCollectionWithCollectionElements(treeLeaves, pAttributeNameElementClass, newSourcePAttributeNames, newTargetPAttributeNames, pAttributeNames,valuesArray);

            applicationService.retainAllInCollection(valueObjectsCollection,transformedTreeLeaves,attributesComparator);

            Object  oldValueObjectsCollection = context.get("valueObjectsCollection");
            Object  valueObjectsCollectionToAdd = context.get("valueObjectsCollectionToAdd");
            context.put("valueObjectsCollection",valueObjectsCollection);
            context.put("valueObjectsCollectionToAdd",transformedTreeLeaves);
            context.put("pAttributeNames",attributesComparator);

            contextApplicationService.addAllToCollection(context);

            context.put("valueObjectsCollection",oldValueObjectsCollection);
            context.put("valueObjectsCollectionToAdd",valueObjectsCollectionToAdd);
            context.put("pAttributeNames",pAttributeNames);

            //contextApplicationService.setInverseForeignKeyFields(context); 
            contextDAO.setInverseForeignKeyFields(context);

        }catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.addToRetainInCollectionTreeLeaves(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToRetainInCollectionTreeLeaves(Context context)" + e.toString(),e);
        }catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.addToRetainInCollectionTreeLeaves(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToRetainInCollectionTreeLeaves(Context context)" + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.addToRetainInCollectionTreeLeaves(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToRetainInCollectionTreeLeaves(Context context)" + e.toString(),e);
        }
    }



    public void addToRetainInCollectionTreeNodes(Context context) throws ServiceFacadeException{
        try{
            ContextApplicationService contextApplicationService = getContextApplicationService(context);
            ApplicationService applicationService = getApplicationService(context);
            ContextDAO contextDAO = getContextDAO(context);
            Object pInstance = context.get("pInstance");
            String pAttributeName =(String) context.get("pAttributeName");
            String[] pkNames = (String[]) context.get("pkNames");
            String[] oldPkNames = (String[]) context.get("pkNames");
            String path = (String) context.get("path");
            String[][] nodeSourcePAttributeNames =(String[][]) context.get("nodeSourcePAttributeNames");
            String[][] nodeTargetPAttributeNames =(String[][]) context.get("nodeTargetPAttributeNames");
            String[] pAttributeNames = (String[]) context.get("pAttributeNames");
            Object[] valuesArray = (Object[]) context.get("valuesArray");

            //addToRetainInCollectionTreeNodes(pInstance,  pAttributeName, pkNames, path,  nodeSourcePAttributeNames, nodeTargetPAttributeNames, pAttributeNames, valuesArray, applicationService, contextDAO);

            Object oldCollectionImplClass = context.get("collectionImplClass");//added by Alessandro on 8-dec-2008
            context.put("collectionImplClass",null);     //added by Alessandro on 8-dec-2008
            Collection valueObjectsCollection = contextApplicationService.getReferenceCollectionOrEmptyIfNull(context);


            if (valueObjectsCollection == null) return;

            Object realClass = context.get("realClass");
            context.put("realClass",pInstance.getClass());
            context.put("path",pAttributeName);
            Class collectionImplClass = contextDAO.getCollectionClassFromPath(context);
            Class pAttributeNameElementClass  =  contextDAO.getClassFromPath(context);
            context.put("path",path);
            if (pkNames== null){
                //pkNames = contextDAO.getPkNames(context); //deleted by Alessandro on 03-dec-2008
                pkNames = contextApplicationService.getPkNames(context); //added by Alessandro on 03-dec-2008
                context.put("pkNames",pkNames);
            }

            //Object oldCollectionImplClass = context.get("collectionImplClass"); deleted by Alessandro on 8-dec-2008

            context.put("collectionImplClass",collectionImplClass);
            context.put("realClass",pAttributeNameElementClass);
            if(nodeTargetPAttributeNames==null)  context.put("nodeTargetPAttributeNames",nodeSourcePAttributeNames); // added by Alessandro on 3-dec-2008

            Collection collectionToCompare = contextApplicationService.createCollectionWithTreeNodes(context);

            context.put("nodeTargetPAttributeNames",nodeTargetPAttributeNames); // added by Alessandro on 3-dec-2008

            if(log.isDebugEnabled()) {
                if(collectionToCompare == null) {
                    log.debug("addToRetainInCollectionTreeNodes: collectionToCompare is null");
                } else   {
                    log.debug("addToRetainInCollectionTreeNodes: collectionToCompare.size()= "+collectionToCompare.size());
                }
            }

            context.put("collectionImplClass",oldCollectionImplClass);
            context.put("realClass",realClass);

            applicationService.retainAllInCollection(valueObjectsCollection,collectionToCompare,pkNames);


            Object  oldValueObjectsCollection = context.get("valueObjectsCollection");
            Object  valueObjectsCollectionToAdd = context.get("valueObjectsCollectionToAdd");
            context.put("valueObjectsCollection",valueObjectsCollection);
            context.put("valueObjectsCollectionToAdd",collectionToCompare);
            context.put("pAttributeNames",pkNames);

            contextApplicationService.addAllToCollection(context);

            context.put("valueObjectsCollection",oldValueObjectsCollection);
            context.put("valueObjectsCollectionToAdd",valueObjectsCollectionToAdd);
            context.put("pAttributeNames",pAttributeNames);

            context.put("pkNames",oldPkNames);

            //contextApplicationService.setInverseForeignKeyFields(context); //deleted by Alessandro on 3-dec-2008
            contextDAO.setInverseForeignKeyFields(context); // added by Alessandro on 3-dec-2008

        }catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.addToRetainInCollectionTreeNodes(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToRetainInCollectionTreeNodes(Context context)" + e.toString(),e);
        }catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.addToRetainInCollectionTreeNodes(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToRetainInCollectionTreeNodes(Context context)" + e.toString(),e);
        }catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.addToRetainInCollectionTreeNodes(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToRetainInCollectionTreeNodes(Context context)" + e.toString(),e);
        }
    }



    public void createValueObjectsTreeWithCollection(Context context) throws ServiceFacadeException{
        try{
            PropertyUtilsBean propertyUtilsBean = BeanUtilsBean.getInstance().getPropertyUtils();
            ContextApplicationService contextApplicationService = getContextApplicationService(context);

            Object pInstance = context.get("pInstance");
            String pAttributeName = (String) context.get("pAttributeName");
            Collection  valueObjectsCollection = (Collection) context.get("valueObjectsCollection");
            if(pAttributeName!=null)  context.put("valueObjectsCollection",(Collection) propertyUtilsBean.getProperty(pInstance,pAttributeName));


            contextApplicationService.createValueObjectsTreeWithCollection(context);
            if(pAttributeName!=null) context.put("valueObjectsCollection",valueObjectsCollection);

        } catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.createValueObjectsTreeWithCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createValueObjectsTreeWithCollection(Context context)" + e.toString(),e);
        } catch (IllegalAccessException e) {
            log.error("IllegalAccessException caught in ContextPojoFacade.createValueObjectsTreeWithCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createValueObjectsTreeWithCollection(Context context)" + e.toString(),e);
        } catch (NoSuchMethodException e) {
            log.error("NoSuchMethodException caught in ContextPojoFacade.createValueObjectsTreeWithCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createValueObjectsTreeWithCollection(Context context)" + e.toString(),e);
        } catch (InvocationTargetException e) {
            log.error("InvocationTargetException caught in ContextPojoFacade.createValueObjectsTreeWithCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createValueObjectsTreeWithCollection(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.createValueObjectsTreeWithCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createValueObjectsTreeWithCollection(Context context)" + e.toString(),e);
        }
    }


    public void addToValueObjectsTreeWithCollection(Context context) throws ServiceFacadeException{
        try{

            PropertyUtilsBean propertyUtilsBean = BeanUtilsBean.getInstance().getPropertyUtils();
            ContextApplicationService contextApplicationService = getContextApplicationService(context);

            Object pInstance = context.get("pInstance");
            String pAttributeName = (String) context.get("pAttributeName");
            Collection  valueObjectsCollection = (Collection) context.get("valueObjectsCollection");
            //if(pAttributeName!=null) valueObjectsCollection = (Collection) propertyUtilsBean.getProperty(pInstance,pAttributeName);
            if(pAttributeName!=null) context.put("valueObjectsCollection", (Collection) propertyUtilsBean.getProperty(pInstance,pAttributeName));


            contextApplicationService.addToValueObjectsTreeWithCollection(context);
            if(pAttributeName!=null) context.put("valueObjectsCollection", valueObjectsCollection);

        } catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.addToValueObjectsTreeWithCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToValueObjectsTreeWithCollection(Context context)" + e.toString(),e);
        } catch (IllegalAccessException e) {
            log.error("IllegalAccessException caught in ContextPojoFacade.addToValueObjectsTreeWithCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToValueObjectsTreeWithCollection(Context context)" + e.toString(),e);
        }catch (InvocationTargetException e) {
            log.error("InvocationTargetException caught in ContextPojoFacade.addToValueObjectsTreeWithCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToValueObjectsTreeWithCollection(Context context)" + e.toString(),e);
        }catch (NoSuchMethodException e) {
            log.error("NoSuchMethodException caught in ContextPojoFacade.addToValueObjectsTreeWithCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToValueObjectsTreeWithCollection(Context context)" + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.addToValueObjectsTreeWithCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToValueObjectsTreeWithCollection(Context context)" + e.toString(),e);
        }
    }


    public void addToRelationshipCollectionMissingElements(Context context)throws ServiceFacadeException{
        try{
            ApplicationService applicationService = getApplicationService(context);
            ContextApplicationService contextApplicationService = getContextApplicationService(context);
            ContextDAO contextDAO = getContextDAO(context);

            Object pInstance =context.get("pInstance");
            String collectionName = (String) context.get("collectionName");
            String pAttributeName = (String) context.get("pAttributeName");
            Collection valueObjectsCollection = (Collection) context.get("valueObjectsCollection");
            Collection oldValueObjectsCollection = (Collection) context.get("valueObjectsCollection");
            String[] pAttributeNames = (String[]) context.get("pAttributeNames");
            Object[] valuesArray = (Object[]) context.get("valuesArray");
            /*                                                            
            if (valueObjectsCollection==null){
                Class relatedObjectClass = contextDAO.getClassFromPath(pInstance.getClass(),collectionName+"."+pAttributeName);
                Object templateVO = ConstructorUtils.invokeConstructor(relatedObjectClass,null,null);
                context.put("templateVO",templateVO);
                valueObjectsCollection = contextDAO.findCollectionByTemplate(context);
            }
            */
            /*************************************/

            Object realClass = context.get("realClass");
            Object path = context.get("path");

            context.put("realClass",pInstance.getClass());
            context.put("path",collectionName+"."+pAttributeName);
            Class relatedObjectClass = contextDAO.getClassFromPath(context);

            if (valueObjectsCollection==null){
                Object oldTemplateVO = context.get("templateVO");
                Object templateVO = ConstructorUtils.invokeConstructor(relatedObjectClass,null,null);
                context.put("templateVO",templateVO);
                valueObjectsCollection = contextDAO.findCollectionByTemplate(context);
                context.put("templateVO",oldTemplateVO);
            }


            if (valueObjectsCollection==null) return;

            context.put("path",collectionName);

            Class relationShipClass = contextDAO.getCollectionClassFromPath(context);
            Class relationShipItemClass =contextDAO.getClassFromPath(context);

            Object oneToN = context.get("oneToN");
            Object mToOne = context.get("mToOne");

            context.put("oneToN",collectionName);
            context.put("mToOne",pAttributeName);
            String[] fksToItemClassInDecomposedRelationship = (String[]) contextDAO.getFksToItemClassInDecomposedRelationship(context).toArray(new String[]{});


            context.put("realClass",relatedObjectClass);
            String[] relatedObjectClassPkNames = contextDAO.getPkNames(context);
            Collection temp = BeanCollectionUtils.createCollectionWithCollectionElements(relationShipClass,valueObjectsCollection,relationShipItemClass,relatedObjectClassPkNames,fksToItemClassInDecomposedRelationship,pAttributeNames,valuesArray);

            BeanCollectionUtils.setAttributes(temp, pAttributeName, valueObjectsCollection);

            Object[] keyValues = contextDAO.getKeyValues(context);

            context.put("realClass",pInstance.getClass());
            context.put("pAttributeName",collectionName);
            // start added by Alessandro on 06-dec-2008
            String[] inverseForeignKeyFields = null;
            Collection  inverseForeignKeyFieldsCollection = contextDAO.getInverseForeignKeyFields(context);
            if(inverseForeignKeyFieldsCollection!=null && !inverseForeignKeyFieldsCollection.isEmpty()) {
                inverseForeignKeyFields =(String[]) inverseForeignKeyFieldsCollection.toArray(new String[]{});
                BeanCollectionUtils.setAttributes(temp,inverseForeignKeyFields, keyValues);
            }
            // end added by Alessandro on 06-dec-2008
            /*  deleted by Alessandro on 06-dec-2008
            String[] inverseForeignKeyFields =(String[]) contextDAO.getInverseForeignKeyFields(context).toArray(new String[]{});
            BeanCollectionUtils.setAttributes(temp,inverseForeignKeyFields, keyValues);
            */

            Object collectionImplClass = context.get("collectionImplClass");//added by Alessandro on 8-dec-2008
            context.put("collectionImplClass",null);     //added by Alessandro on 8-dec-2008
            Collection relationShipCollection = contextApplicationService.getReferenceCollectionOrEmptyIfNull(context) ;
            context.put("collectionImplClass",collectionImplClass);     //added by Alessandro on 8-dec-2008

            context.put("realClass",relationShipItemClass);
            //String[] relationShipItemClassPkNames = contextDAO.getPkNames(context);   // deleted by Alessandro on 05-dec-2008
            String[] toPInstanceAndToPAttributeFkNames =(String[]) Utils.arrayUnion(fksToItemClassInDecomposedRelationship,inverseForeignKeyFields); // added by Alessandro on 05-dec-2008

            Object  valueObjectsCollectionToAdd = context.get("valueObjectsCollectionToAdd");
            context.put("valueObjectsCollection",relationShipCollection);
            context.put("valueObjectsCollectionToAdd",temp);
            //context.put("pAttributeNames",relationShipItemClassPkNames); // deleted by Alessandro on 05-dec-2008
            context.put("pAttributeNames",toPInstanceAndToPAttributeFkNames); // added by Alessandro on 05-dec-2008

            contextApplicationService.addAllToCollection(context);

            context.put("valueObjectsCollection",oldValueObjectsCollection);
            context.put("valueObjectsCollectionToAdd",valueObjectsCollectionToAdd);
            context.put("pAttributeNames",pAttributeNames);

            context.put("realClass",realClass);
            context.put("pAttributeName",pAttributeName);
            context.put("oneToN",oneToN);
            context.put("mToOne", mToOne);
            context.put("path",path);
            /*************************************/
            //addToRelationshipCollectionMissingElements(pInstance, collectionName, pAttributeName, valueObjectsCollection,  pAttributeNames, valuesArray,  applicationService,  contextDAO);

        }catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.addToRelationshipCollectionMissingElements( Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToRelationshipCollectionMissingElements( Context context) " + e.toString(),e);
        }catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.addToRelationshipCollectionMissingElements( Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToRelationshipCollectionMissingElements( Context context) " + e.toString(),e);
        }catch (InvocationTargetException e) {
            log.error("InvocationTargetException caught in ContextPojoFacade.addToRelationshipCollectionMissingElements( Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToRelationshipCollectionMissingElements( Context context) " + e.toString(),e);
        }catch (IllegalAccessException e) {
            log.error("IllegalAccessException caught in ContextPojoFacade.addToRelationshipCollectionMissingElements( Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToRelationshipCollectionMissingElements( Context context) " + e.toString(),e);
        }catch (NoSuchMethodException e) {
            log.error("NoSuchMethodException caught in ContextPojoFacade.addToRelationshipCollectionMissingElements( Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToRelationshipCollectionMissingElements( Context context) " + e.toString(),e);
        }catch (InstantiationException e) {
            log.error("InstantiationException caught in ContextPojoFacade.addToRelationshipCollectionMissingElements( Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToRelationshipCollectionMissingElements( Context context) " + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.addToRelationshipCollectionMissingElements( Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToRelationshipCollectionMissingElements( Context context) " + e.toString(),e);
        }
    }



    public void createRelationshipCollection(Context context)throws ServiceFacadeException{
        try{
            ContextApplicationService contextApplicationService = getContextApplicationService(context);
            ContextDAO contextDAO= getContextDAO(context);
            Object pInstance = context.get("pInstance");
            String collectionName = (String) context.get("collectionName");
            //String pAttributeName = (String) context.get("pAttributeName");
            //Collection valueObjectsCollection = (Collection) context.get("valueObjectsCollection");
            //String[] pAttributeNames = (String[]) context.get("pAttributeNames");
            //Object[] valuesArray = (Object[]) context.get("valuesArray");

            //Object[] keyValues = contextDAO.getKeyValues(context);
            Object realClass= context.get("realClass");
            Object keyValues= context.get("keyValues");
            context.put("realClass",pInstance.getClass()) ;
            context.put("keyValues",contextDAO.getKeyValues(context)) ;

            Collection relationShipCollection = contextApplicationService.createRelationshipCollection(context);

            context.put("realClass",realClass) ;
            context.put("keyValues",keyValues) ;

            PropertyUtilsBean propertyUtilsBean = BeanUtilsBean.getInstance().getPropertyUtils();
            propertyUtilsBean.setProperty(pInstance, collectionName, relationShipCollection);

        }catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.createRelationshipCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollection(Context context) " + e.toString(),e);
        }catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.createRelationshipCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollection(Context context) " + e.toString(),e);
        }catch (IllegalAccessException e) {
            log.error("IllegalAccessException caught in ContextPojoFacade.createRelationshipCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollection(Context context) " + e.toString(),e);
        }catch (NoSuchMethodException e) {
            log.error("NoSuchMethodException caught in ContextPojoFacade.createRelationshipCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollection(Context context) " + e.toString(),e);
        }catch (InvocationTargetException e) {
            log.error("InvocationTargetException caught in ContextPojoFacade.createRelationshipCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollection(Context context) " + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.createRelationshipCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollection(Context context) " + e.toString(),e);
        }
    }


    public void createRelationshipCollectionByOrValues(Context context)throws ServiceFacadeException{
        try{
            ContextApplicationService contextApplicationService = getContextApplicationService(context);
            ContextDAO contextDAO = getContextDAO(context);
            Object pInstance = context.get("pInstance");
            String collectionName = (String) context.get("collectionName");
            String pAttributeName =(String) context.get("pAttributeName");
            String orPAttributeName = (String) context.get("orPAttributeName");
            //Collection valuesCollection = (Collection) context.get("valuesCollection");
            //String[] pAttributeNames = (String[]) context.get("pAttributeNames");
            //Object[] valuesArray= (Object[]) context.get("valuesArray");

            Object  realClass = context.get("realClass");
            Object  path = context.get("path");
            context.put("realClass",pInstance.getClass());
            context.put("path",collectionName+"."+pAttributeName);


            Class relatedObjectClass = contextDAO.getClassFromPath(context);

            context.put("realClass",relatedObjectClass);
            context.put("pAttributeName",orPAttributeName);
            Collection valueObjectsCollection = contextDAO.findCollectionByOrValues(context);
            context.put("pAttributeName",pAttributeName);

            Collection relationShipCollection =null;
            Object keyValues =context.get("keyValues");
            context.put("keyValues",contextDAO.getKeyValues(context));

            Object oldValueObjectsCollection = context.get("valueObjectsCollection");
            context.put("valueObjectsCollection",valueObjectsCollection);
            context.put("realClass",pInstance.getClass());

            if (valueObjectsCollection!=null) relationShipCollection = contextApplicationService.createRelationshipCollection(context);

            context.put("realClass",realClass);
            context.put("valueObjectsCollection",oldValueObjectsCollection);
            context.put("keyValues",keyValues);
            context.put("path",path);


            PropertyUtilsBean propertyUtilsBean = BeanUtilsBean.getInstance().getPropertyUtils();
            propertyUtilsBean.setProperty(pInstance, collectionName, relationShipCollection);
        }catch (ApplicationServiceException e) {
            log.error("ApplicationServicexception caught in ContextPojoFacade.createRelationshipCollectionByOrValues(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollectionByOrValues(Context context)" + e.toString(),e);
        }catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.createRelationshipCollectionByOrValues(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollectionByOrValues(Context context)" + e.toString(),e);
        }catch (NoSuchMethodException e) {
            log.error("NoSuchMethodException caught in ContextPojoFacade.createRelationshipCollectionByOrValues(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollectionByOrValues(Context context)" + e.toString(),e);
        }catch (InvocationTargetException e) {
            log.error("InvocationTargetException caught in ContextPojoFacade.createRelationshipCollectionByOrValues(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollectionByOrValues(Context context)" + e.toString(),e);
        }catch (IllegalAccessException e) {
            log.error("IllegalAccessException caught in ContextPojoFacade.createRelationshipCollectionByOrValues(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollectionByOrValues(Context context)" + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.createRelationshipCollectionByOrValues(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollectionByOrValues(Context context)" + e.toString(),e);
        }
    }


    public void createRelationshipCollectionBySearchValueInFields(Context context)throws ServiceFacadeException{
        try{
            ContextApplicationService contextApplicationService = getContextApplicationService(context);
            ContextDAO contextDAO = getContextDAO(context);
            Object pInstance = context.get("pInstance");
            String collectionName = (String) context.get("collectionName");
            String pAttributeName = (String) context.get("pAttributeName");
            String[] toSearchInPAttributeNames = (String[]) context.get("toSearchInPAttributeNames");
            //Object value  = context.get("value");
            String[] pAttributeNames = (String[]) context.get("pAttributeNames");
            //Object[] valuesArray = (Object[]) context.get("valuesArray");

            Object  realClass = context.get("realClass");
            Object  path = context.get("path");
            context.put("realClass",pInstance.getClass());
            context.put("path",collectionName+"."+pAttributeName);

            Class relatedObjectClass = contextDAO.getClassFromPath(context);

            context.put("realClass",relatedObjectClass);
            context.put("pAttributeNames",toSearchInPAttributeNames);
            Collection valueObjectsCollection = contextDAO.searchValueInFields(context);
            context.put("pAttributeNames",pAttributeNames);

            Object  oldValueObjectsCollection = context.get("valueObjectsCollection");
            context.put("valueObjectsCollection",valueObjectsCollection);



            Collection relationShipCollection =null;
            Object keyValues = context.get("keyValues");
            context.put("keyValues",contextDAO.getKeyValues(context));
            context.put("realClass",pInstance.getClass());

            if (valueObjectsCollection!=null) relationShipCollection = contextApplicationService.createRelationshipCollection(context);

            context.put("realClass",realClass);
            context.put("keyValues",keyValues);
            context.put("valueObjectsCollection",oldValueObjectsCollection);
            context.put("path",path);


            PropertyUtilsBean propertyUtilsBean = BeanUtilsBean.getInstance().getPropertyUtils();
            propertyUtilsBean.setProperty(pInstance, collectionName, relationShipCollection);
        }catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.createRelationshipCollectionBySearchValueInFields(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollectionBySearchValueInFields(Context context)" + e.toString(),e);
        }catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.createRelationshipCollectionBySearchValueInFields(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollectionBySearchValueInFields(Context context)" + e.toString(),e);
        }catch (NoSuchMethodException e) {
            log.error("NoSuchMethodException caught in ContextPojoFacade.createRelationshipCollectionBySearchValueInFields(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollectionBySearchValueInFields(Context context)" + e.toString(),e);
        }catch (InvocationTargetException e) {
            log.error("InvocationTargetException caught in ContextPojoFacade.createRelationshipCollectionBySearchValueInFields(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollectionBySearchValueInFields(Context context)" + e.toString(),e);
        }catch (IllegalAccessException e) {
            log.error("IllegalAccessException caught in ContextPojoFacade.createRelationshipCollectionBySearchValueInFields(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollectionBySearchValueInFields(Context context)" + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.createRelationshipCollectionBySearchValueInFields(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createRelationshipCollectionBySearchValueInFields(Context context)" + e.toString(),e);
        }
    }


    public boolean addToCollection(Context context) throws ServiceFacadeException{
        try{
            boolean added = false;
            ContextDAO contextDAO = getContextDAO(context);
            ContextApplicationService contextApplicationService = getContextApplicationService(context);
            Object pInstance = context.get("pInstance");
            String pAttributeName = (String) context.get("pAttributeName");
            Object toAddPInstance = context.get("toAddPInstance");

            /* deleted by Alessandro on 7-dec-2008
            Object[] collectionHolderkeyValues = contextDAO.getKeyValues(context);

            if (Utils.areAllArrayElementsNotNull(collectionHolderkeyValues)) throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToCollection(Object pInstance, String pAttributeName, Object toAddPInstance): null key values in pInstance ");
            */

            Object collectionImplClass = context.get("collectionImplClass");//added by Alessandro on 8-dec-2008
            context.put("collectionImplClass",null);     //added by Alessandro on 8-dec-2008
            Collection valueObjectsCollection = contextApplicationService.getReferenceCollectionOrEmptyIfNull(context);
            context.put("collectionImplClass",collectionImplClass);   //added by Alessandro on 8-dec-2008

            // start added by Alessandro on 7-dec-2008
            if(valueObjectsCollection == null) return added;
            String[] exceptLastTokenAndLastToken = Utils.getExceptLastTokenAndLastToken(pAttributeName);
            String exceptLastToken = exceptLastTokenAndLastToken[0];
            context.put("pAttributeName",exceptLastToken);
            Object[] collectionHolderkeyValues = contextApplicationService.getKeyValues(context);
            context.put("pAttributeName",pAttributeName);
            if (collectionHolderkeyValues ==null) throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToCollection(Context context) : collectionHolderkeyValues == null");
            if (!Utils.areAllArrayElementsNotNull(collectionHolderkeyValues)) throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToCollection(Context context) : null key values in pInstance ");
            // end added by Alessandro on 7-dec-2008


            Object oldValueObjectsCollection = context.get("valueObjectsCollection");
            //context.put("valueObjectsCollection",valueObjectsCollection);

            Object realClass = context.get("realClass");
            context.put("realClass",pInstance.getClass());
            String[] toAddPInstancePkNames = contextApplicationService.getPkNames(context);
            // start added by Alessandro on 07-dec-2008
            String[] inverseForeignKeyFields = null;
            Collection  inverseForeignKeyFieldsCollection = contextDAO.getInverseForeignKeyFields(context);
            if(inverseForeignKeyFieldsCollection!=null && !inverseForeignKeyFieldsCollection.isEmpty()) {
                inverseForeignKeyFields =(String[]) inverseForeignKeyFieldsCollection.toArray(new String[]{});
                BeanCollectionUtils.setAttributes(toAddPInstance,inverseForeignKeyFields, collectionHolderkeyValues);
            }
            // end added by Alessandro on 07-dec-2008
            
            /*deleted   by Alessandro on 07-dec-2008
            String[] inverseForeignKeyFields =(String[]) contextDAO.getInverseForeignKeyFields(context).toArray(new String[]{});
            BeanCollectionUtils.setAttributes(toAddPInstance,inverseForeignKeyFields,collectionHolderkeyValues);
            */

            context.put("pInstance",toAddPInstance);
            context.put("valueObjectsCollection",null);
            if (!contextApplicationService.isKeyNotNull(context))throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToCollection(Object pInstance, String pAttributeName, Object toAddPInstance): null key values in toAddPInstance ");
            //context.put("valueObjectsCollection",valueObjectsCollection); //deleted y Alessandro on 08-dec-2008

            Object oldPAttributeNames = context.get("pAttributeNames");
            context.put("pAttributeNames",toAddPInstancePkNames);



            context.put("valueObjectsCollection",valueObjectsCollection);
            if(valueObjectsCollection!=null) added = contextApplicationService.addToCollection(context);

            context.put("pInstance",pInstance);
            context.put("pAttributeNames",oldPAttributeNames);
            context.put("valueObjectsCollection",oldValueObjectsCollection);
            context.put("realClass",realClass);
            return added;
        }catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.addToCollection(Context context) : " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToCollection(Context context) " + e.toString(),e);
        }catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.addToCollection(Context context) : " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToCollection(Context context) " + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.addToCollection(Context context) : " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToCollection(Context context) " + e.toString(),e);
        }
    }






    public boolean addAllToCollection(Context context) throws ServiceFacadeException{
        log.info("************Entering the ContextPojoFacade.addAllToCollection(Context context) ***************");
        try{
            //addAllToCollection(Object pInstance, String pAttributeName, Collection  valueObjectsCollectionToAdd)
            //addAllToCollection(Collection valueObjectsCollection, Collection  valueObjectsCollectionToAdd, String[] pAttributeNames)
            //addAllToCollection(Collection valueObjectsCollection, Collection  valueObjectsCollectionToAdd, Class realClass)
            //addAllToCollection(Class targetRealClass, Collection valueObjectsCollection, Collection  valueObjectsCollectionToAdd,String[] sourcePAttributeNames,String[] targetPAttributeNames, String[] pAttributeNames,Object[] valuesArray)
            //addAllToCollection(Collection valueObjectsCollection, Map map, Collection  valueObjectsCollectionToAdd, String pAttributeNameMapKey)
            boolean added;
            ApplicationService applicationService;
            ContextApplicationService contextApplicationService = getContextApplicationService(context);
            ContextDAO contextDAO = getContextDAO(context);

            Collection  valueObjectsCollectionToAdd = (Collection) context.get("valueObjectsCollectionToAdd");
            if(valueObjectsCollectionToAdd==null || valueObjectsCollectionToAdd.isEmpty())return false;

            Object pInstance = context.get("pInstance");
            String pAttributeName = (String) context.get("pAttributeName");
            if(pInstance!=null && pAttributeName!=null) {
                //return addAllToCollection(null, null, null,  context);



                /* deleted by Alessandro on 8-dec-2008
                Object[] pInstanceKeyValues = contextDAO.getKeyValues(context);
                if (Utils.areAllArrayElementsNotNull(pInstanceKeyValues)) throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addAllToCollection(Context context): null key values in toAddPInstance ");
                */
                Object collectionImplClass = context.get("collectionImplClass");
                context.put("collectionImplClass",null);
                Collection valueObjectsCollection = contextApplicationService.getReferenceCollectionOrEmptyIfNull(context);
                context.put("collectionImplClass",collectionImplClass);

                if (valueObjectsCollection == null) return false;

                // start added by Alessandro on 8-dec-2008
                String[] exceptLastTokenAndLastToken = Utils.getExceptLastTokenAndLastToken(pAttributeName);
                String exceptLastToken = exceptLastTokenAndLastToken[0];
                context.put("pAttributeName",exceptLastToken);
                Object[] collectionHolderkeyValues = contextApplicationService.getKeyValues(context);
                context.put("pAttributeName",pAttributeName);
                if (collectionHolderkeyValues ==null) throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addAllToCollection(Context context) : collectionHolderkeyValues == null");
                if (!Utils.areAllArrayElementsNotNull(collectionHolderkeyValues)) throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addAllToCollection(Context context) : null key values in pInstance ");
                // end added by Alessandro on 8-dec-2008


                Object realClass = context.get("realClass");
                context.put("realClass",pInstance.getClass());

                // start added by Alessandro on 08-dec-2008
                String[] inverseForeignKeyFields = null;
                Collection  inverseForeignKeyFieldsCollection = contextDAO.getInverseForeignKeyFields(context);
                if(inverseForeignKeyFieldsCollection!=null && !inverseForeignKeyFieldsCollection.isEmpty()) {
                    inverseForeignKeyFields =(String[]) inverseForeignKeyFieldsCollection.toArray(new String[]{});
                    BeanCollectionUtils.setAttributes(valueObjectsCollectionToAdd,inverseForeignKeyFields,collectionHolderkeyValues);
                }
                // end added by Alessandro on 08-dec-2008

                /*deleted   by Alessandro on 08-dec-2008
                String[] inverseForeignKeyFields =(String[]) contextDAO.getInverseForeignKeyFields(context).toArray(new String[]{});
                BeanCollectionUtils.setAttributes(valueObjectsCollectionToAdd,inverseForeignKeyFields,pInstanceKeyValues);
                */
                context.put("realClass",realClass);

                Object oldValueObjectsCollection = context.get("valueObjectsCollection"); // added  by Alessandro on 08-dec-2008
                context.put("valueObjectsCollection",valueObjectsCollectionToAdd);   // added  by Alessandro on 08-dec-2008
                context.put("pInstance",null);
                if (!contextApplicationService.isKeyNotNull(context))throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToCollection(Context context): null key values in some element of valueObjectsCollectionToAdd ");
                context.put("pInstance",pInstance);
                context.put("realClass",pInstance.getClass());
                String[] toAddPInstancePkNames = contextApplicationService.getPkNames(context);
                context.put("realClass",realClass);

                added=false;
                //Object  oldValueObjectsCollection = context.get("valueObjectsCollection"); // deleted by Alessandro on 08-dec-2008
                Object  oldPAttributeNames = context.get("pAttributeNames");
                context.put("valueObjectsCollection",valueObjectsCollection); // deleted by Alessandro on 08-dec-2008
                context.put("pAttributeNames",toAddPInstancePkNames);
                context.put("pAttributeName",null);
                added = contextApplicationService.addAllToCollection(context);
                context.put("pAttributeName",pAttributeName);
                context.put("pAttributeNames",oldPAttributeNames);
                context.put("valueObjectsCollection",oldValueObjectsCollection);
                return added;


            }

            Collection valueObjectsCollection = (Collection) context.get("valueObjectsCollection");

            String pAttributeNameMapKey = (String) context.get("pAttributeNameMapKey") ;
            String[] pAttributeNames = (String[]) context.get("pAttributeNames");
            if(pAttributeNameMapKey!=null) {
                log.debug("addToCollection: pAttributeNameMapKey!=null");
                context.put("pAttributeNames",null);
                added = contextApplicationService.addAllToCollection(context);
                context.put("pAttributeNames",pAttributeNames);
                return added;
            }


            Class realClass = (Class) context.get("realClass");
            if(realClass!=null) {
                context.put("pAttributeNames", contextDAO.getPkNames(context));
                added =  contextApplicationService.addAllToCollection(context);
                context.put("pAttributeNames", pAttributeNames);
                return added;
            }

            Object[] valuesArray = (Object[]) context.get("valuesArray");
            if(pAttributeNames!=null && valuesArray == null){
                return  contextApplicationService.addAllToCollection(context);
            }

            Class targetRealClass = (Class) context.get("targetRealClass");
            String[] sourcePAttributeNames = (String[]) context.get("sourcePAttributeNames");
            String[] targetPAttributeNames =  (String[]) context.get("targetPAttributeNames");

            Collection temp = BeanCollectionUtils.createCollectionWithCollectionElements(valueObjectsCollectionToAdd,targetRealClass,sourcePAttributeNames,targetPAttributeNames,pAttributeNames,valuesArray);

            context.put("pInstance",null);
            context.put("valueObjectsCollection",temp);
            if(!contextApplicationService.isKeyNotNull(context))throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addAllToCollection(Context context): null key values in some element to add to valueObjectsCollection ");
            context.put("pInstance",pInstance);
            context.put("valueObjectsCollection",valueObjectsCollection);

            context.put("pAttributeNameMapKey",null);
            context.put("valueObjectsCollectionToAdd",temp);
            context.put("realClass",targetRealClass);
            context.put("pAttributeNames",contextDAO.getPkNames(context));
            context.put("realClass",realClass);


            added = contextApplicationService.addAllToCollection(context);
            context.put("pAttributeNameMapKey",pAttributeNameMapKey);
            context.put("valueObjectsCollectionToAdd",valueObjectsCollectionToAdd);
            context.put("pAttributeNames",pAttributeNames);
            return added;



        } catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.addAllToCollection(Context context)" + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addAllToCollection(Context context) " + e.toString(),e);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.addAllToCollection(Context context)" + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addAllToCollection(Context context) " + e.toString(),e);
        } catch (Exception e) {
            log.error("DataAccessException caught in ContextPojoFacade.addAllToCollection(Context context)" + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addAllToCollection(Context context) " + e.toString(),e);
        }
    }



    public boolean retainAllInCollection(Context context) throws ServiceFacadeException{
        //retainAllInCollection(Object pInstance, String pAttributeName, Collection  toRetainValueObjectsCollection)
        //retainAllInCollection(Collection valueObjectsCollection, Collection  toRetainValueObjectsCollection, Class realClass)
        //retainAllInCollection(Collection valueObjectsCollection, Collection toRetainValueObjectsCollection, String[] pAttributeNames)
        //public boolean retainAllInCollection(Collection valueObjectsCollection, Map map, String pAttributeNameMapKey)

        try{
            ContextApplicationService contextApplicationService = getContextApplicationService(context);
            ApplicationService applicationService = getApplicationService(context);
            ContextDAO contextDAO = getContextDAO(context);
            PropertyUtilsBean propertyUtilsBean = BeanUtilsBean.getInstance().getPropertyUtils();

            Object pInstance = context.get("pInstance");
            String pAttributeName = (String) context.get("pAttributeName");
            Class realClass = (Class) context.get("realClass");
            Collection valueObjectsCollection;
            String[] pAttributeNames;
            Collection  toRetainValueObjectsCollection = (Collection) context.get("toRetainValueObjectsCollection");
            if(pInstance!=null && pAttributeName!=null) {

                //valueObjectsCollection = (Collection) propertyUtilsBean.getProperty(pInstance,pAttributeName); // deleted by Alessandro on 8-dec-2008
                //valueObjectsCollection = (Collection) Utils.getPropertyIfNotNullOnPath(pInstance,pAttributeName);    // Added by Alessandro on 8-dec-2008
                valueObjectsCollection = (Collection) BeanCollectionUtils.getPropertyIfNotNullOnPath(pInstance,pAttributeName);    // Added by Alessandro on 8-dec-2008
                context.put("realClass",pInstance.getClass());
                pAttributeNames = contextApplicationService.getPkNames(context);
                context.put("realClass",realClass);
                return applicationService.retainAllInCollection( valueObjectsCollection,  toRetainValueObjectsCollection,  pAttributeNames);
            }

            valueObjectsCollection = (Collection) context.get("valueObjectsCollection");
            Map map = (Map) context.get("map");
            String pAttributeNameMapKey = (String) context.get("pAttributeNameMapKey") ;

            if(pAttributeNameMapKey!=null) return applicationService.retainAllInCollection(valueObjectsCollection, map, pAttributeNameMapKey);

            if(realClass!=null){
                String[] pkNames = contextDAO.getPkNames(context);
                return applicationService.retainAllInCollection(valueObjectsCollection, toRetainValueObjectsCollection, pkNames);
            }

            pAttributeNames = (String[]) context.get("pAttributeNames");
            return applicationService.retainAllInCollection( valueObjectsCollection,  toRetainValueObjectsCollection,  pAttributeNames);

        }catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.retainAllInCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retainAllInCollection(Context context)" + e.toString(),e);
        }catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.retainAllInCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retainAllInCollection(Context context)" + e.toString(),e);
        }catch (IllegalAccessException e) {
            log.error("IllegalAccessException caught in ContextPojoFacade.retainAllInCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retainAllInCollection(Context context)" + e.toString(),e);
        }catch (InvocationTargetException e) {
            log.error("InvocationTargetException caught in ContextPojoFacade.retainAllInCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retainAllInCollection(Context context)" + e.toString(),e);
        }catch (NoSuchMethodException e) {
            log.error("NoSuchMethodException caught in ContextPojoFacade.retainAllInCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retainAllInCollection(Context context)" + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.retainAllInCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.retainAllInCollection(Context context)" + e.toString(),e);
        }
    }


    public boolean addToRetainInCollection(Context context)throws ServiceFacadeException{
        try{

            Collection  valueObjectsCollectionToAddAndRetain = (Collection) context.get("valueObjectsCollectionToAddAndRetain");
            Collection toRetainValueObjectsCollection = (Collection) context.get("toRetainValueObjectsCollection");

            context.put("toRetainValueObjectsCollection",valueObjectsCollectionToAddAndRetain);
            boolean retained =  retainAllInCollection(context);
            context.put("toRetainValueObjectsCollection",toRetainValueObjectsCollection);

            Class targetRealClass = (Class) context.get("targetRealClass");
            Collection  valueObjectsCollectionToAdd = (Collection) context.get("valueObjectsCollectionToAdd");
            String[] sourcePAttributeNames = (String[]) context.get("sourcePAttributeNames");
            String[] targetPAttributeNames = (String[]) context.get("targetPAttributeNames");
            Object[] valuesArray = (Object[]) context.get("valuesArray");

            context.put("targetRealClass",null);
            context.put("valueObjectsCollectionToAdd",valueObjectsCollectionToAddAndRetain);
            context.put("sourcePAttributeNames",null);
            context.put("targetPAttributeNames",null);
            context.put("valuesArray",null);

            boolean added = addAllToCollection(context);

            context.put("targetRealClass",targetRealClass);
            context.put("valueObjectsCollectionToAdd",valueObjectsCollectionToAdd);
            context.put("sourcePAttributeNames",sourcePAttributeNames);
            context.put("targetPAttributeNames",targetPAttributeNames);
            context.put("valuesArray",valuesArray);

            return (retained || added);

        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.addToRetainInCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addToRetainInCollection(Context context)" + e.toString(),e);
        }
    }



    public boolean removeFromCollection(Context context) throws ServiceFacadeException{
        try{
            ContextDAO contextDAO = getContextDAO(context);
            ContextApplicationService contextApplicationService = getContextApplicationService(context);

            Object pInstance = context.get("pInstance");
            String pAttributeName = (String) context.get("pAttributeName");
            Collection valueObjectsCollection = (Collection) context.get("valueObjectsCollection");
            Object toRemovePInstance = context.get("toRemovePInstance");

            String[] pAttributeNames = (String[]) context.get("pAttributeNames");
            Object realClass = context.get("realClass");
            context.put("realClass",toRemovePInstance.getClass());
            context.put("pAttributeNames",contextDAO.getPkNames(context));
            context.put("realClass",realClass);
            if(pInstance!=null && pAttributeName!=null ){
                PropertyUtilsBean propertyUtilsBean = BeanUtilsBean.getInstance().getPropertyUtils();
                //context.put("valueObjectsCollection", (Collection)propertyUtilsBean.getProperty(pInstance,pAttributeName)); // deleted by Alessandro on 9-dec-2008
                context.put("valueObjectsCollection", (Collection)BeanCollectionUtils.getPropertyIfNotNullOnPath(pInstance,pAttributeName));  // added by Alessandro on 9-dec-2008
            }

            boolean removed =  contextApplicationService.removeFromCollection(context);

            context.put("valueObjectsCollection", valueObjectsCollection);
            context.put("pAttributeNames",pAttributeNames);

            return removed;
        } catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.removeFromCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.removeFromCollection(Context context)" + e.toString(),e);
        } catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.removeFromCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.removeFromCollection(Context context)" + e.toString(),e);
        }catch (IllegalAccessException e) {
            log.error("IllegalAccessException caught in ContextPojoFacade.removeFromCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.removeFromCollection(Context context)" + e.toString(),e);
        }catch (InvocationTargetException e) {
            log.error("InvocationTargetException caught in ContextPojoFacade.removeFromCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.removeFromCollection(Context context)" + e.toString(),e);
        }catch (NoSuchMethodException e) {
            log.error("NoSuchMethodException caught in ContextPojoFacade.removeFromCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.removeFromCollection(Context context)" + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.removeFromCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.removeFromCollection(Context context)" + e.toString(),e);
        }
    }



    public boolean removeAllFromCollection(Context context) throws ServiceFacadeException{
        try{
            ContextApplicationService contextApplicationService = getContextApplicationService(context);
            Object pInstance = context.get("pInstance");
            String pAttributeName = (String) context.get("pAttributeName");
            Collection  valueObjectsCollectionToRemove = (Collection) context.get("valueObjectsCollectionToRemove");

            if(valueObjectsCollectionToRemove==null || valueObjectsCollectionToRemove.isEmpty())return false;

            PropertyUtilsBean propertyUtilsBean = BeanUtilsBean.getInstance().getPropertyUtils();

            Object oldValueObjectsCollection = context.get("valueObjectsCollection");

            //Collection valueObjectsCollection =(Collection) propertyUtilsBean.getProperty(pInstance,pAttributeName); //deleted by Alessandro on 8-dec-2008
            Collection valueObjectsCollection =(Collection) BeanCollectionUtils.getPropertyIfNotNullOnPath(pInstance,pAttributeName); //added by Alessandro on 8-dec-2008
            if (valueObjectsCollection == null || valueObjectsCollection.isEmpty()) return false;

            context.put("valueObjectsCollection",valueObjectsCollection);

            Object realClass = context.get("realClass");
            String[] pAttributeNames = (String[]) context.get("pAttributeNames");
            context.put("realClass",pInstance.getClass());
            context.put("pAttributeNames",contextApplicationService.getPkNames(context));



            String[] pkNames = contextApplicationService.getPkNames(context);
            context.put("realClass",realClass);
            boolean removed= contextApplicationService.removeAllFromCollection(context);

            context.put("pAttributeNames",pAttributeNames);
            context.put("valueObjectsCollection",oldValueObjectsCollection);

            return removed;

        } catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.removeAllFromCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.removeAllFromCollection(Context context) " + e.toString(),e);
        } catch (IllegalAccessException e) {
            log.error("IllegalAccessException caught in ContextPojoFacade.removeAllFromCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.removeAllFromCollection(Context context) " + e.toString(),e);
        }catch (InvocationTargetException e) {
            log.error("InvocationTargetException caught in ContextPojoFacade.removeAllFromCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.removeAllFromCollection(Context context) " + e.toString(),e);
        }catch (NoSuchMethodException e) {
            log.error("NoSuchMethodException caught in ContextPojoFacade.removeAllFromCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.removeAllFromCollection(Context context) " + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.removeAllFromCollection(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.removeAllFromCollection(Context context) " + e.toString(),e);
        }
    }








    public Object createVOfromVO(Context context) throws ServiceFacadeException{
        try{

            ContextDAO contextDAO = getContextDAO(context);

            Class sourceRealClass = (Class) context.get("sourceRealClass");
            String[] pkFieldNames = (String[]) context.get("pkFieldNames");
            Object[] pkValues = (Object[]) context.get("pkValues");
            Class targetRealClass = (Class) context.get("targetRealClass");
            String[] sourcePAttributeNames = (String[]) context.get("sourcePAttributeNames");
            String[] targetPAttributeNames = (String[]) context.get("targetPAttributeNames");
            String[] pAttributeNames = (String[]) context.get("pAttributeNames");
            Object[] valuesArray =(Object[]) context.get("valuesArray");
            if(sourceRealClass!=null && pkFieldNames!=null) {
                //return createVOfromVO(  sourceRealClass, pkFieldNames,  pkValues,  targetRealClass,  sourcePAttributeNames, targetPAttributeNames, pAttributeNames, valuesArray, contextDAO);
                Object realClass = context.get("realClass");
                context.put("realClass",sourceRealClass);
                Object sourceVO = contextDAO.findByPrimaryKey(context);
                context.put("realClass",realClass);
                Object targetVO = ConstructorUtils.invokeConstructor(targetRealClass,null,null) ;
                BeanCollectionUtils.setAttributes(targetVO, pAttributeNames, valuesArray);
                if (sourceVO==null) return targetVO;
                BeanCollectionUtils.setAttributes(sourceVO,sourcePAttributeNames,targetVO,targetPAttributeNames); // surely sourceVO and targetVO are both not null
                return targetVO;
            }
            if(sourceRealClass!=null ) {
                //return createVOfromVO(  sourceRealClass,  pkValues,  targetRealClass,  sourcePAttributeNames, targetPAttributeNames, pAttributeNames, valuesArray, contextDAO);
                Object realClass = context.get("realClass");
                context.put("realClass",sourceRealClass);
                Object sourceVO = contextDAO.findByPrimaryKey(context);
                context.put("realClass",realClass);
                Object targetVO = ConstructorUtils.invokeConstructor(targetRealClass,null,null) ;
                BeanCollectionUtils.setAttributes(targetVO, pAttributeNames, valuesArray);
                if (sourceVO==null) return targetVO;
                BeanCollectionUtils.setAttributes(sourceVO, sourcePAttributeNames, targetVO, targetPAttributeNames);
                return targetVO;
            }
            Object sourcePInstance = context.get("sourcePInstance");
            //return createVOfromVO(  sourcePInstance,  targetRealClass,  sourcePAttributeNames, targetPAttributeNames, pAttributeNames, valuesArray);
            Object targetPInstance = ConstructorUtils.invokeConstructor(targetRealClass,null,null) ;
            BeanCollectionUtils.setAttributes(targetPInstance, pAttributeNames, valuesArray);
            if (sourcePInstance==null) return targetPInstance;
            BeanCollectionUtils.setAttributes(sourcePInstance,sourcePAttributeNames,targetPInstance,targetPAttributeNames);
            return targetPInstance;
        }catch (NoSuchMethodException e) {
            log.error("NoSuchMethodException caught in ContextPojoFacade.createVOfromVO(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createVOfromVO(Context context)" + e.toString(),e);
        }catch (IllegalAccessException e) {
            log.error("IllegalAccessException caught in ContextPojoFacade.createVOfromVO(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createVOfromVO(Context context)" + e.toString(),e);
        }catch (InvocationTargetException e) {
            log.error("InvocationTargetException caught in ContextPojoFacade.createVOfromVO(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createVOfromVO(Context context)" + e.toString(),e);
        }catch (InstantiationException e) {
            log.error("InstantiationException caught in ContextPojoFacade.createVOfromVO(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createVOfromVO(Context context)" + e.toString(),e);
        }catch (DataAccessException e) {
            log.error("DataAccessException caught in ContextPojoFacade.createVOfromVO(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createVOfromVO(Context context)" + e.toString(),e);
        }catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.createVOfromVO(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.createVOfromVO(Context context)" + e.toString(),e);
        }
    }




    public boolean addTreeToTree(Context context)throws ServiceFacadeException{
        try{
            ContextApplicationService contextApplicationService = getContextApplicationService(context);
            return  contextApplicationService.addTreeToTree(context);
        } catch (ApplicationServiceException e) {
            log.error("ApplicationServiceException caught in ContextPojoFacade.addTreeToTree(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addTreeToTree(Context context)" + e.toString(),e);
        } catch (Exception e) {
            log.error("Exception caught in ContextPojoFacade.addTreeToTree(Context context): " + e.toString());
            throw new ServiceFacadeException("ServiceFacadeException thrown in ContextPojoFacade.addTreeToTree(Context context)" + e.toString(),e);
        }
    }
}